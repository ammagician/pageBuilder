(function(){var n=function(e,t){if(e.length==0){t&&t();return}var n=0;var i=0;var s=""+(new Date).getTime();for(var o=0,a=e.length;o<a;o++){var r=e[o];var l=r.indexOf("!css")===0;if(l){r=r.substring(4)}var d=r.indexOf("!abs")===0;var c=d?r.substring(5):r;if(c.indexOf("/")==0){c=c.substring(1)}c+="?_"+s;var h=document.getElementsByTagName("head")[0];var f;if(l){f=document.createElement("link");f.rel="stylesheet";f.href=c;debugger}else{f=document.createElement("script");f.type="text/javascript";f.src=c}n++;if(f.readyState){f.onreadystatechange=function(){if(f.readyState=="loaded"||f.readyState=="complete"){i++;if(i>0&&i===n){t&&t()}}}}else{f.onload=function(e){i++;if(i>0&&i===n){t&&t()}}}h.appendChild(f)}};var i=function(e,t){e=e||{};this.name=e.name;this.dependencies=e.dependencies||[];this.files=e.files||[];this.state="ready";this.builder=t;this.events=e.events||{};this.launchFn=e.launch;this.inited=false;this.loadedFns=[];this.renderDom=[];if(e.dom){if(typeof e.dom==="string"){e.dom=document.getElementById(e.dom)}this.renderDom.push(e.dom)}if(this.builder.debug){console.info("Block["+this.name+"] created")}};i.prototype={broadcast:function(e,t,n){if(this.builder.debug){console.info("Block["+this.name+"] broadcast event["+t+"] to "+e)}this.builder.broadcast(this.name,e,t,n)},clear:function(e){if(this.builder.debug){console.info("Block["+this.name+"] clear")}this.stop&&this.stop();delete this.builder[this.name];this.builder=null;this.events={};this.launchFn=null;this.loadedFns=[];for(var t=0,n=this.renderDom.length;t<n;t++){this.renderDom[t].innerHTML=""}this.renderDom=[];this.render=null;e&&e(this)},start:function(){},stop:function(){},addEventListener:function(e,t){this.events[e]=t;if(this.builder.debug){console.info("Block["+this.name+"] add event "+e)}},renderTo:function(e){this.renderDom.push(e);if(this.inited){this._renderTo(e)}},_callEvent:function(e,t,n){this.events[t]&&this.events[t].call(this,e,n)},_launch:function(){if(this.builder.debug){console.info("Block["+this.name+"] launch")}if(typeof this.launchFn==="function"){var e=this.builder._getBlocks(this.dependencies);this.launchFn(e,this)}this.inited=true;for(var t=0,n=this.renderDom.length;t<n;t++){var i=this.renderDom[t];this._renderTo(i)}this.start&&this.start()},_renderTo:function(e){this.render&&this.render(e)}};var e=function(){this.blocks={};this.debug=false};e.prototype={init:function(e){e=e||[];for(var t=0,n=e.length;t<n;t++){var i=e[t];this.define(i)}},define:function(e){if(!e||typeof e.name!=="string"||e.name===""){console.error("Name of Page Block is wrong!");return}var t=e.name;if(this.blocks[t]){console.warn("Page Block is exist! -----  "+t);return}var n=new i(e,this);this.blocks[t]=n},_loadDependencies:function(e,t){var n=e.dependencies;var i=n.length;var s=0;var o=this;for(var a=0,r=n.length;a<r;a++){var l=n[a];this.load(l,function(){s++;if(s===i){o._loadFiles(e,t)}})}},_loadFiles:function(e,t){n(e.files,t)},_getBlocks:function(e){var t=[];for(var n=0,i=e.length;n<i;n++){var s=this.blocks[e];t.push(s)}return t},broadcast:function(e,t,n,i){e=e||"PageBuildBlock";var s=this.blocks;if(t!=="all"&&this.blocks[t]){s=[this.blocks[t]]}for(var o in s){if(o!=e){s[o]._callEvent(e,n,i)}}},addEventListener:function(e,t,n){var i=this.blocks[e];if(i){i.addEventListener(t,n)}},load:function(s,e){var o=this.blocks[s];var a=this;var t=function(){o.state="loaded";var e=a._getBlocks(o.dependencies);for(var t=0,n=o.loadedFns.length;t<n;t++){var i=o.loadedFns[t];i&&i(e,o)}o._launch();a.broadcast(s,"all","launch","Block["+s+"] launched")};if(o){o.loadedFns.push(e);if(o.state=="loaded"){var n=this._getBlocks(o.dependencies);t&&t(n,o)}else if(o.state=="ready"){console.info("loading "+o.name);o.state="loading";if(o.dependencies&&o.dependencies.length>0){this._loadDependencies(o,t)}else{this._loadFiles(o,t)}}}},register:function(e,t){var n=this.blocks[e];if(!n){console.error("Page Block is not defined! -----  "+e);return}n.launchFn=t},startBlock:function(e){var t=this.blocks[e];if(t){t.start();this.broadcast(e,"all","start","Block["+e+"] start")}},stopBlock:function(e){var t=this.blocks[e];if(t){t.stop();this.broadcast(e,"all","stop","Block["+e+"] stop")}},clearBlock:function(e,t){var n=this.blocks[e];if(n){n.clear(t)}},enableDebug:function(e){this.debug=!!e}};window.PageBuilder=new e})();